@page "/keranjang"
@layout CustomerLayout
@inherits KeranjangFormBase

<PageTitle>Keranjang</PageTitle>

@if (!_loaded)
{
    <MudProgressCircular Indeterminate />
}
else
{
    <MudContainer Class="my-8">
        <MudText Typo="Typo.h4" Class="mb-3">Keranjang</MudText>

        <MudStack Row Spacing="4">
            <MudStack Class="flex-1">
                @foreach (DetailPesanan detail in _pesanan.DetailPesanan)
                {
                    <MudPaper Class="border-solid border mud-border-dark">
                        <MudStack Row>
                            <div class="d-flex flex-column align-center w-125 pa-2">
                                <MudImage Src="@(detail.Menu.Gambar != null ? string.Format($"data:image/gif;base64,{Convert.ToBase64String(detail.Menu.Gambar!)}") : "/images/piring_kosong.png")" Fluid Alt="Gambar Menu" ObjectFit="ObjectFit.Cover" Class="rounded-lg" />
                            </div>
                            <MudStack Class="flex-1" Spacing="0">
                                <MudText Typo="Typo.subtitle1" Class="mt-1">@detail.Menu.Nama</MudText>
                                <MudText Typo="Typo.caption" Style="color: grey;">@detail.Menu.Kategori.GetDescription()</MudText>
                                <MudSpacer />
                                <MudText Typo="Typo.overline">@detail.Jumlah x Rp @detail.Harga.ToString("N0")</MudText>
                            </MudStack>
                            <MudStack Class="my-1 mr-2">
                                <div class="w-125 gap-4 d-flex flex-row align-center">
                                    <MudIconButton Variant="Variant.Filled" Size="Size.Small" Icon="@Icons.Material.Filled.Delete" Color="Color.Error" OnClick="async e => await DeleteAsync(detail)" />
                                    <MudNumericField Immediate T="int" Min="1" @bind-Value="detail.Jumlah" @bind-Value:after="async () => await ModifyAsync(detail)" />
                                </div>
                                <MudSpacer />
                                <div class="w-125 d-flex flex-row-reverse align-center">
                                    <MudText Class="text-right bold" Typo="Typo.subtitle1">Rp @detail.Total.ToString("N0")</MudText>
                                    @if (detail.Diskon > 0)
                                    {
                                        <MudText Class="text-right bold mr-2 mud-error-text" Typo="Typo.overline">-@detail.Diskon.ToString("P0")</MudText>
                                    }
                                </div>
                            </MudStack>
                        </MudStack>
                    </MudPaper>
                }

                @if (_pesanan.MenuPromoPesanan.Any())
                {
                    <MudText Typo="Typo.h5" Class="mt-6">Promo yang didapat</MudText>

                    @foreach (MenuPromoPesanan menuPromo in _pesanan.MenuPromoPesanan)
                    {
                        <MudPaper Class="border-solid border mud-border-dark">
                            <MudStack Row>
                                <div class="d-flex flex-column align-center w-125 pa-2">
                                    <MudImage Src="@(menuPromo.Menu.Gambar != null ? string.Format($"data:image/gif;base64,{Convert.ToBase64String(menuPromo.Menu.Gambar!)}") : "/images/piring_kosong.png")" Fluid Alt="Gambar Menu" ObjectFit="ObjectFit.Cover" Class="rounded-lg" />
                                </div>
                                <MudStack Class="flex-1" Spacing="0">
                                    <MudText Typo="Typo.subtitle1" Class="mt-1">@menuPromo.Menu.Nama</MudText>
                                    <MudText Typo="Typo.caption" Style="color: grey;">@menuPromo.Menu.Kategori.GetDescription()</MudText>
                                    <MudSpacer />
                                    <MudText Typo="Typo.overline">Jumlah : @menuPromo.Jumlah</MudText>
                                </MudStack>
                            </MudStack>
                        </MudPaper>
                    }
                }
            </MudStack>
            <MudStack Class="w-300">
                <MudPaper Class="pa-2 border-solid border mud-border-dark">
                    <MudText Typo="Typo.h5" Class="text-center bold mb-3">Ringkasan Belanja</MudText>
                    <MudStack Row>
                        <div class="w-125">
                            <MudText Typo="Typo.h6">Subtotal</MudText>
                        </div>
                        <div>
                            <MudText Typo="Typo.h6">: Rp @_pesanan.Subtotal.ToString("N0")</MudText>
                        </div>
                    </MudStack>
                    <MudStack Row>
                        <div class="w-125">
                            <MudText Typo="Typo.h6">Potongan</MudText>
                        </div>
                        <div>
                            <MudText Typo="Typo.h6">: Rp @_pesanan.Potongan.ToString("N0")</MudText>
                        </div>
                    </MudStack>
                    <MudDivider />
                    <MudStack Row>
                        <div class="w-125">
                            <MudText Typo="Typo.h6">Total Belanja</MudText>
                        </div>
                        <div>
                            <MudText Typo="Typo.h6">: Rp @_pesanan.Total.ToString("N0")</MudText>
                        </div>
                    </MudStack>
                    <MudButton Variant="Variant.Filled" Color="Color.Success" OnClick="SaveAsync" Class="wp-100 mt-8">Checkout</MudButton>
                </MudPaper>
            </MudStack>
        </MudStack>
    </MudContainer>
}

@* <MudMessageBox @ref="_msgEditJumlah" Title="Konfirmasi Hapus">
    <MessageContent>
        <MudPaper Elevation="0" MinWidth="300px" Class="mx-5">
            <MudText Typo="Typo.h6">Hapus berapa banyak?</MudText>
            <MudSlider @bind-Value="_jumlah"></MudSlider>
        </MudPaper>
    </MessageContent>
    <NoButton>
        <MudButton Variant="Variant.Filled" Class="ma-1" Color="Color.Error" Size="Size.Small">Ya</MudButton>
    </NoButton>
    <YesButton>
        <MudButton Class="ma-1" Size="Size.Small">Tidak</MudButton>
    </YesButton>
</MudMessageBox> *@