@page "/home"
@inherits HomeBase
@layout CustomerLayout
@inject AuthenticationStateProvider AuthenticationStateProvider

<PageTitle>Home</PageTitle>
@if (!_loaded)
{
    <MudProgressCircular Indeterminate />
}
else
{
    <MudContainer Class="mt-16">
        <MudStack Row Spacing="2">
            <MudText Typo="Typo.h5" GutterBottom>Daftar Menu</MudText>
            <MudTooltip Text="Refresh" Arrow Placement="Placement.Bottom">
                <MudIconButton Variant="Variant.Filled" Size="Size.Small" Color="Color.Dark" Icon="@Icons.Material.Filled.Refresh" OnClick="LoadDataAsync" />
            </MudTooltip>
            <MudSpacer />
            <MudTextField Immediate @bind-Value="_searchTerms" @bind-Value:after="SearchData" Placeholder="Cari menu makanan..." Adornment="Adornment.Start" AdornmentIcon="@Icons.Material.Filled.Search" IconSize="Size.Medium" Class="mt-0" Disabled="!_loaded" />
        </MudStack>

        <div class="mt-3 grid">
            @foreach (var menu in _displayedMenu)
            {
                <MudCard Class="relative">
                    <MudCardMedia Style="background-size: 100% 100%;" Image="@(menu.Menu.Gambar != null ? string.Format($"data:image/gif;base64,{Convert.ToBase64String(menu.Menu.Gambar!)}") : "/images/piring_kosong.png")" Height="200" />
                    <MudCardContent Class="mb-12">
                        <MudText Typo="Typo.subtitle1">@menu.Menu.Nama</MudText>
                        <MudText Typo="Typo.caption" Style="color: grey;">@menu.Menu.Kategori.GetDescription()</MudText>
                    </MudCardContent>
                    <MudCardActions Class="wp-100 absolute mt-12" Style="bottom: 0">
                        <MudStack Row Spacing="1" Class="flex-1" Justify="Justify.Center">
                            <MudText Typo="Typo.subtitle1">Rp @menu.Menu.Harga.ToString("N0")</MudText>
                            <MudSpacer />
                            <div class="d-flex">
                                <MudButton Variant="Variant.Filled" Size="Size.Small" StartIcon="@Icons.Material.Filled.AddShoppingCart" Color="Color.Warning" OnClick="e => { ClosePopups(); _jumlah = 1; menu.Open = true; }">Tambah</MudButton>
                                <MudPopover Open="menu.Open" AnchorOrigin="Origin.TopCenter" TransformOrigin="Origin.BottomCenter" Paper="false">
                                    <MudPaper Outlined="true" Class="pa-4 w-200">
                                        <MudText Typo="Typo.h6" GutterBottom>Pesan Berapa?</MudText>
                                        <MudNumericField Class="mb-3" T="int" @bind-Value="_jumlah" Min="1" Max="100" AutoFocus />
                                        <MudStack Row>
                                            <MudButton Class="w-75" Color="Color.Primary" OnClick="async e => { ClosePopups(); await TambahKeKeranjangAsync(menu.Menu); _jumlah = 1; }">Ok</MudButton>
                                            <MudButton Class="w-75" OnClick="e => { ClosePopups(); _jumlah = 1; }">Batal</MudButton>
                                        </MudStack>
                                    </MudPaper>
                                </MudPopover>
                            </div>
                        </MudStack>
                    </MudCardActions>
                </MudCard>
            }
        </div>
        <MudStack Row Justify="Justify.SpaceBetween" Class="mt-4">
            <div class="flex-1">
                <div class="w-175">
                    <MudSelect Dense @bind-Value="_dataPerPage" @bind-Value:after="ShowData" Label="Data per Halaman">
                        <MudSelectItem Value="20">20</MudSelectItem>
                        <MudSelectItem Value="50">50</MudSelectItem>
                        <MudSelectItem Value="100">100</MudSelectItem>
                    </MudSelect>
                </div>
            </div>
            <div class="w-300 d-flex justify-center">
                <MudPagination BoundaryCount="2" MiddleCount="5" ShowFirstButton ShowLastButton ShowPreviousButton="false" ShowNextButton="false" @bind-Selected="_currentPage" @bind-Selected:after="() => ShowData()" Count="@((_filteredMenu.Count() + _dataPerPage - 1) / _dataPerPage)" />
            </div>
            <div class="flex-1 d-flex justify-end align-center">
                <MudText Typo="Typo.h6">@((_dataPerPage * (_currentPage - 1)) + 1) - @(_dataPerPage * _currentPage < _filteredMenu.Count() ? _dataPerPage * _currentPage : _filteredMenu.Count()) dari @_filteredMenu.Count() menu</MudText>
            </div>
        </MudStack>
    </MudContainer>
}

@* <MudDialog @bind-Visible="_menuCountVisible">
    <TitleContent>
        <MudText Typo="Typo.h6">
            Tambah "@(_menuTerpilih?.Nama)" ke keranjang
        </MudText>
    </TitleContent>
    <DialogContent>
        <MudNumericField Label="Jumlah" T="int" @bind-Value="_jumlah" Min="1" Max="100" AutoFocus />
        <MudButton Class="w-75" Color="Color.Primary" OnClick="e => { TambahKeranjang(_menuTerpilih); _menuCountVisible = false; _menuTerpilih = null!; }">Ok</MudButton>
        <MudButton Class="w-75" OnClick="e => { _menuCountVisible = false; _menuTerpilih = null!; }">Batal</MudButton>
    </DialogContent>
    <DialogActions>
        <MudButton Class="w-75" Color="Color.Primary" OnClick="e => { TambahKeranjang(_menuTerpilih); _menuCountVisible = false; _menuTerpilih = null!; }">Ok</MudButton>
        <MudButton Class="w-75" OnClick="e => { _menuCountVisible = false; _menuTerpilih = null!; }">Batal</MudButton>
    </DialogActions>
</MudDialog> *@